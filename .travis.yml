language: c
sudo: true
dist: trusty

branches:
  only:
    - travisci    #Master only builds for prod. For now changing it to Travis CI Branch
                  #dev branch push will triger build for non prod deployment

install:
- nvm install 6
- npm install electron-builder@next

cache:
  directories:
  - "$HOME/.npm"
before_script:
  - sudo apt update
  - sudo apt-get install npm
  - mkdir dist2
  #Cloning other repos
  - git clone https://github.com/Kitsune-tools/Ana-Analytics-Dashboard.git
  - git clone https://github.com/Kitsune-tools/ANAChat-Web.git
  - rm -rf node_modules/
  #For analytics-dash
  - cd Ana-Analytics-Dashboard/
  - npm i npm@latest -g
  - sudo npm install typings -g
  - npm install @angular-devkit/core
  - sudo npm install -g @angular/cli@1.6.1
  - sudo npm i node-sass
  - sudo npm ci
  - ng build --prod --aot=false
  - cd ..
  - mkdir dist2/analytics-dashboard
  - cp -R Ana-Analytics-Dashboard/dist/* dist2/analytics-dashboard/
  - ls -l
  - ls -l Ana-Analytics-Dashboard/
  #For Chat-Web
  - cd ANAChat-Web/
  - sudo npm i node-sass
  - sudo npm install
  - ng build --prod --aot=false
  - cd ..
  - mkdir dist2/simulator  # For web chat
  - ls -l ANAChat-Web/
  - cp -R ANAChat-Web/dist/* dist2/simulator/
  # For ana APP
  - sudo npm install
  - ng build --prod --aot=false
  - ls -l
  - mkdir dist/simulator
  - mkdir dist/analytics-dashboard
  - cp -R dist2/simulator/* dist/simulator/
  - cp -R dist2/analytics-dashboard/* dist/analytics-dashboard/
  
script:
  - npm install -g electron-builder
  - npm install -g popper.js
  - npm install -g jquery
  - sudo apt install snap
  - sudo apt install snapd
  - sudo snap install snapcraft --classic
  - cd dist/
  - npm install
  - electron-builder

notifications:
  email:
    - soumyajit.dutta@nowfloats.com
    # - khaja.nizamuddin@nowfloats.com
  slack:
    on_success: always
    on_failure: always